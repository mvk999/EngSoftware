@startuml  
title
Diagrama de Sequência - Vought Tech
 
Fluxo: Criar Categoria (POST /categorias)
end title

actor Admin
participant "Rota POST /categorias" as Route
participant CategoriaController
participant CategoriaService
participant CategoriaRepository
database DB

Admin -> Route: Envia dados (nome)
Route -> CategoriaController: createCategoria(req, res)

alt validação no controller
  alt nome inválido (< 3 caracteres)
    CategoriaController -> Route: responde 400 - Nome inválido. Mínimo 3 caracteres
    return
  end
end

CategoriaController -> CategoriaService: createCategoria(nome)

alt validações do service
  alt nome inválido (< 3 caracteres)
    CategoriaService -> CategoriaController: "lança AppError (Nome deve ter ao menos 3 caracteres)"
    CategoriaController -> Route: responde 400 - Nome deve ter ao menos 3 caracteres
    return
  end
end

CategoriaService -> CategoriaRepository: getCategoriaByNome(nome)
CategoriaRepository -> DB: SELECT id_categoria, nome FROM categorias WHERE LOWER(nome) = LOWER($1)
DB --> CategoriaRepository: categoria existente (ou null)

alt categoria já existe
  CategoriaRepository --> CategoriaService: categoria encontrada
  CategoriaService -> CategoriaController: "lança AppError (Já existe categoria com esse nome)"
  CategoriaController -> Route: responde 400 - Já existe uma categoria com esse nome
  return
else
  CategoriaRepository --> CategoriaService: null (não existe)
  
  CategoriaService -> CategoriaRepository: createCategoria(nome)
  CategoriaRepository -> DB: INSERT INTO categorias (nome) VALUES ($1) RETURNING *
  DB --> CategoriaRepository: categoria criada
  CategoriaRepository --> CategoriaService: nova categoria
  
  CategoriaService -> CategoriaController: retorna categoria criada
  CategoriaController -> Route: responde 201 (categoria criada)
  Route -> Admin: retorna dados da nova categoria
end

@enduml
